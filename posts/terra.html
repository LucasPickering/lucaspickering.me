<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="theme-color" content="#212930"/><meta name="color-scheme" content="dark"/><title>Terra | Lucas Pickering</title><meta name="description" content="A hexagon-tile terrain generation system. Dynamically generate and explore terrain. This is a generic toolkit that can be used to generate terrain for renderings, games, etc."/><meta name="og:title" content="Terra"/><meta name="og:image" content="https://res.cloudinary.com/lucaspickering/image/upload/c_fill,h_627,w_1200/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0"/><meta name="og:description" content="A hexagon-tile terrain generation system. Dynamically generate and explore terrain. This is a generic toolkit that can be used to generate terrain for renderings, games, etc."/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/c869e15313d8c8f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c869e15313d8c8f4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d991ec486b6ac606.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d991ec486b6ac606.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-4e065fbaf2e2b008.js" defer=""></script><script src="/_next/static/chunks/pages/_app-729e580be42ddda4.js" defer=""></script><script src="/_next/static/chunks/898-ea6b68af18d4f8fb.js" defer=""></script><script src="/_next/static/chunks/10-48f1fb0fb22276a2.js" defer=""></script><script src="/_next/static/chunks/pages/posts/terra-872f27a65157e1f2.js" defer=""></script><script src="/_next/static/i5MmosjG3cE47I0KcjUcI/_buildManifest.js" defer=""></script><script src="/_next/static/i5MmosjG3cE47I0KcjUcI/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="PageContainer_contentWrapper__MxbyT utils_narrow__mDe6j"><header class="NavHeader_navHeader__7GzgE"><nav class="NavHeader_navBar__CYOGB"><a class="NavHeader_titleLink__8irOL" href="/">Lucas Pickering</a><div class="NavHeader_otherLinks__21IHn"><a href="/projects">Projects</a><a href="/photos">Photos</a><a href="/about">About</a><a href="https://github.com/LucasPickering">GitHub</a></div></nav></header><main class="PageContainer_mainContent__fVQiP"><article><header class="PostView_postHeader__SoKpZ"><div class="PostView_headerText__xk49b"><h1 class="PostView_postTitle__RS_kO">Terra</h1><p class="PostView_postSummary__p9Wei">A hexagon-tile terrain generation system. Dynamically generate and explore terrain. This is a generic toolkit that can be used to generate terrain for renderings, games, etc.</p><div class="PostView_postLinks__1v7I_"><a href="https://github.com/LucasPickering/terra-rs">Code</a><a href="https://terra.lucaspickering.me">Site</a></div></div><img alt="TODO" sizes="100vw" srcSet="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 640w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 750w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 828w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 1080w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 1200w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 1920w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 2048w, https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0 3840w" src="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/banner_xhecnx?_a=ATO2BIE0" width="800" height="300" decoding="async" data-nimg="future" class="PostView_banner__4tsnF" loading="lazy" style="color:transparent"/></header><div class="PostView_postBody__lxIA8"><h2>Intro</h2>
<p>Terra is a 3D hexagon-based terrain generation library. It provides a highly configurable series of algorithms that can generate lifelike terrain. The core library itself doesn&#x27;t actually render the terrain, it just returns it in a format that makes rendering simple. It also includes a simple demo that renders the terrain in 3D, to see what it&#x27;s capable of (<a href="#demo">skip to the demo now</a>).</p>
<p>Shoutout to Amit Patel for <a href="https://www.redblobgames.com/grids/hexagons/">this post</a>, which has been an endless resource of information for working with hex grids.</p>
<h2>How does it work?</h2>
<p>The generator takes in a configuration object that contains a bunch of parameters that define the generation process. Chief among these is the <a href="https://en.wikipedia.org/wiki/Random_seed">random seed</a>. Beyond that, there are lots of different levers to control how different steps in the process behave. Based on the configuration, the generator applies a series of steps to initialize the world and create terrain.</p>
<p>If you&#x27;re curious, all the code for terrain generation <a href="https://github.com/LucasPickering/terra-rs/tree/master/crates/core/src/world/generate">lives here</a>.</p>
<h3>Step 0 - Initialize the world</h3>
<p>We start by initializing a world based on the defined world radius in the config. Each tile is initialized but doesn&#x27;t actually have any properties assigned yet. I haven&#x27;t included a picture for this step because there isn&#x27;t really anything to see yet.</p>
<h3>Step 1 - Generate elevation maps</h3>
<p>We start by defining an elevation for each tile, using a <a href="https://en.wikipedia.org/wiki/Perlin_noise">Perlin noise function</a>. Once again, credit to Amit Patel with <a href="https://www.redblobgames.com/maps/terrain-from-noise/">another great post</a> that explains noise-based terrain generation.</p>
<p>At this point, our terrain map looks something like this, where each tile has an elevation defined, but nothing else.</p>
<figure class="Images_images__8Dmua" style="grid-template-columns:repeat(1, 1fr)"><img alt="TODO" srcSet="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/elevation_af9kpl?_a=ATO2BIE0 1x" src="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/elevation_af9kpl?_a=ATO2BIE0" width="0" height="0" decoding="async" data-nimg="future" loading="lazy" style="color:transparent;width:100%;height:auto"/><figcaption class="Images_caption__1dNbT">The red tiles are the highest elevation while the white tiles are the lowest.</figcaption></figure>
<h3>Step 2 - Simulate rainfall</h3>
<p>Without going into too much detail, as this logic is subject to change, we simulate rainfall across the terrain. To do this, we first define where oceans will form based on which tiles are below sea level. Then, we pick a prevailing wind direction, which is uniform over the terrain. From there we can simulate evaporation (which occurs over bodies of water) and rainfall (which collects on tiles). This simulation is elevation-aware, meaning the spread of rainfall is affected by mountains. So land that is downwind of bodies of water gets the most rain, while land downwind of a mountain range won&#x27;t get very much rain at all.</p>
<p>At this point, each land tile will have some amount of rainfall assigned to it, which will be a function of its proximity to the ocean plus proximity to mountains and other elevation features. From here we can move onto the next step, which is simulating how that water flows and collects.</p>
<figure class="Images_images__8Dmua" style="grid-template-columns:repeat(1, 1fr)"><img alt="TODO" srcSet="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/humidity_qliycy?_a=ATO2BIE0 1x" src="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/humidity_qliycy?_a=ATO2BIE0" width="0" height="0" decoding="async" data-nimg="future" loading="lazy" style="color:transparent;width:100%;height:auto"/><figcaption class="Images_caption__1dNbT">The green tiles are the get the most rainfall while the white are the driest.</figcaption></figure>
<h3>Step 3 - Simulate runoff</h3>
<p>Runoff simulation is the process of simulating how water flows from one tile to the next, and where that runoff collects. The purpose of this step is to determine where rivers and lakes would naturally form on the terrain. The actual algorithms involved here are pretty complicated and subject to change so I won&#x27;t detail them too much, but the simplified version is this:</p>
<p>For each tile, we track two things:</p>
<ol>
<li>How much water collects on it</li>
<li>How much water flows over it, including where it flows from and where it flows to</li>
</ol>
<p>Once we have those, we can easily place lakes on tiles that collect a lot of water and rivers on tiles that have high water flow rates. When it&#x27;s all said and done, here&#x27;s what our map will look like:</p>
<figure class="Images_images__8Dmua" style="grid-template-columns:repeat(1, 1fr)"><img alt="TODO" srcSet="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/runoff_cqbeg5?_a=ATO2BIE0 1x" src="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/runoff_cqbeg5?_a=ATO2BIE0" width="0" height="0" decoding="async" data-nimg="future" loading="lazy" style="color:transparent;width:100%;height:auto"/><figcaption class="Images_caption__1dNbT">In this map, green represents runoff flow while blue is collected runoff. So the greenest tiles will become rivers, while the bluest will become lakes. Black tiles have little to no runoff flow over them, and gray tiles are ocean.</figcaption></figure>
<h3>Step 4 - Assign biomes</h3>
<p>Terra has a number of different biomes, which are assigned to tiles based on each tile&#x27;s individual elevation and humidity. By now we know what elevation is, but what is humidity? Humidity is derived from rainfall, meaning tiles that get the most rain are the most humid. Makes sense, right?</p>
<p>Because of the methodology we use to generation elevation and simulate rainfall, they both form in smooth gradients where each tile is going to have a pretty similar elevation &amp; humidity to the ones next to it. This means that biomes form in nice, natural-looking clusters.</p>
<p>So after all these steps, we end up with our final product!</p>
<figure class="Images_images__8Dmua" style="grid-template-columns:repeat(1, 1fr)"><img alt="TODO" srcSet="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/final_w5m4zz?_a=ATO2BIE0 1x" src="https://res.cloudinary.com/lucaspickering/image/upload/v1/lucaspickering.me/terra/final_w5m4zz?_a=ATO2BIE0" width="0" height="0" decoding="async" data-nimg="future" loading="lazy" style="color:transparent;width:100%;height:auto"/><figcaption class="Images_caption__1dNbT">Tile color here represents biomes. The darkest green is jungle, the tan is plains, etc.</figcaption></figure>
<h2>So what are you gonna do with this?</h2>
<p>Right now this project exists on its own, meaning I&#x27;m not using it as part of any other projects. But given its modular and configurable design, I plan to use it as part of a few different game ideas that I have. Interesting terrain can be used in all kinds of different ways to make games feel varied and immersive. For now though, I&#x27;m just working on fleshing out this project.</p>
<p>TL;DR: You&#x27;ll have to wait and see.</p>
<h2>Can I use it?</h2>
<p>Please do! The crate isn&#x27;t published to <a href="https://crates.io">crates.io</a> (yet), but you can pull it in via the git URL, with something like this:</p>
<pre><code class="Code_code__UWNdR language-toml">terra = { git = &quot;https://github.com/LucasPickering/terra-rs&quot;, branch = &quot;master&quot; }
</code></pre>
<p>If do you start using this, please let me know what you think! Always open to suggestions, and if people are actually using this I can put it up on <code class="Code_code__UWNdR">crates.io</code> to make usage easier.</p>
<h2>Demo</h2>
<p>This demo is a simple TypeScript app that renders Terra terrain in 3D, entirely in the browser. This is accomplished by compiling Terra to <a href="https://webassembly.org/">WebAssembly</a>, then importing it from the TypeScript app. This is just a simple example of what you can do with Terra. The standalone version is available at <a href="https://terra.lucaspickering.me/">terra.lucaspickering.me</a>.</p></div></article></main><footer class="PageContainer_footer__GBF3t"><span>Copyright <!-- -->2024<!-- --> Lucas Pickering</span><a href="/">Recursion!</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/terra","query":{},"buildId":"i5MmosjG3cE47I0KcjUcI","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>